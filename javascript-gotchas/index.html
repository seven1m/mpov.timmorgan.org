<!doctype html><html lang=en-us><head><title>JavaScript Gotchas | My Point of View</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Here are some common time sinks encountered when building a JavaScript app, along with some tips to avoid them.
Note: these tips were originally shared as a part of my TulsaWebDevs presentation following 2012 Startup Weekend Tulsa.
Bind üîóIn JavaScript, scope is resolved during a function&rsquo;s execution &ndash; not its definition. When working with classes, you expect that this will point to the class, but it often won&rsquo;t.
Example:
var Todo = Backbone."><meta name=generator content="Hugo 0.101.0"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/images/favicon.png type=image/x-icon></head><body><nav class=navigation><a href=/><span class=arrow>‚Üê</span>Home</a>
<a href=/tags>Tags</a>
<a href=/about>About</a></nav><main class=main><section id=single><h1 class=title>JavaScript Gotchas</h1><div class=tip><time datetime="2013-04-30 00:00:00 +0000 UTC">Apr 30, 2013</time>
<span class=split>¬∑</span>
<span>537 words</span>
<span class=split>¬∑</span>
<span>3 minute read</span></div><div class=content><p>Here are some common time sinks encountered when building a JavaScript app, along with some tips to avoid them.</p><p><em>Note: these tips were originally shared as a part of my <a href="http://tulsawebdevs.org/startup-weekend-project-picirus-and-javascript-gotchas/?utm_source=rss&utm_medium=rss&utm_campaign=startup-weekend-project-picirus-and-javascript-gotchas" target=_blank rel=noopener>TulsaWebDevs presentation</a> following 2012 <a href=http://tulsa.startupweekend.org target=_blank rel=noopener>Startup Weekend Tulsa</a>.</em></p><h2 id=bind>Bind <a href=#bind class=anchor>üîó</a></h2><p>In JavaScript, scope is resolved during a function&rsquo;s execution &ndash; not its definition. When working with classes, you expect that <code>this</code> will point to the class, but it often won&rsquo;t.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>Todo</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Backbone</span>.<span style=color:#a6e22e>View</span>.<span style=color:#a6e22e>extend</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>events</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;click input&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;check&#39;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>check</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>function</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#66d9ef>this</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>Solution 1:</p><p>Use <code>_.bindAll()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>Todo</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Backbone</span>.<span style=color:#a6e22e>View</span>.<span style=color:#a6e22e>extend</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>events</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;click input&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;check&#39;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>initialize</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>function</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>_</span>.<span style=color:#a6e22e>bindAll</span>(<span style=color:#66d9ef>this</span>, <span style=color:#e6db74>&#39;check&#39;</span>);
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>check</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>function</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#66d9ef>this</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>Solution 2:</p><p>Use CoffeeScript <code>=></code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-coffeescript data-lang=coffeescript><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Todo</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Backbone</span>.<span style=color:#a6e22e>View</span>
</span></span><span style=display:flex><span>  events:
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;click input&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;check&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  check: <span style=color:#a6e22e>=&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span> <span style=color:#66d9ef>this</span>
</span></span></code></pre></div><h2 id=callback-spaghetti>Callback Spaghetti <a href=#callback-spaghetti class=anchor>üîó</a></h2><p>As your app grows more complicated, your code will start to look like this (unless you work hard to avoid it):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>before</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>done</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>server</span>.<span style=color:#a6e22e>server</span>(<span style=color:#a6e22e>options</span>, <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>db</span>, <span style=color:#a6e22e>providers</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>//clear db and add a test user - &#34;testuser&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>remove</span>({}, <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>notification</span>.<span style=color:#a6e22e>remove</span>({}, <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>providers</span>.<span style=color:#a6e22e>provider1</span>.<span style=color:#a6e22e>insertBulk</span>(<span style=color:#a6e22e>item1</span>, <span style=color:#a6e22e>item2</span>, <span style=color:#a6e22e>item3</span>],
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>result</span>) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>providers</span>.<span style=color:#a6e22e>provider2</span>.<span style=color:#a6e22e>insert</span>([<span style=color:#a6e22e>item1</span>, <span style=color:#a6e22e>item2</span>, <span style=color:#a6e22e>item3</span>]
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>result</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>providers</span>.<span style=color:#a6e22e>provider3</span>.<span style=color:#a6e22e>insert</span>([<span style=color:#a6e22e>item1</span>, <span style=color:#a6e22e>item2</span>, <span style=color:#a6e22e>item3</span>]
</span></span><span style=display:flex><span>              <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>result</span>) {
</span></span><span style=display:flex><span>              <span style=color:#a6e22e>providers</span>.<span style=color:#a6e22e>provider4</span>.<span style=color:#a6e22e>insert</span>([<span style=color:#a6e22e>item1</span>, <span style=color:#a6e22e>item2</span>, <span style=color:#a6e22e>item3</span>],
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>result</span>) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>listen</span>();
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>done</span>();
</span></span><span style=display:flex><span>                })
</span></span><span style=display:flex><span>              });
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>          });
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>While I have no perfect solution, here are some tips:</p><p><strong>1. Split callbacks out into separate methods on the class:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>click</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>function</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>$</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/foo&#39;</span>, <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>data</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// do something
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  });
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>&mldr;becomes:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>click</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>function</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>$</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/foo&#39;</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>clickCallback</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>clickCallback</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>data</span>) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// do something
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>Rinse, repeat.</p><p><strong>2. Use the <a href=https://github.com/caolan/async target=_blank rel=noopener>async</a> or <a href=https://github.com/substack/node-seq target=_blank rel=noopener>Seq</a> library</strong></p><p>Waterfall:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>async</span>.<span style=color:#a6e22e>waterfall</span>([
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>callback</span>){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>callback</span>(<span style=color:#66d9ef>null</span>, <span style=color:#e6db74>&#39;one&#39;</span>, <span style=color:#e6db74>&#39;two&#39;</span>);
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>arg1</span>, <span style=color:#a6e22e>arg2</span>, <span style=color:#a6e22e>callback</span>){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>callback</span>(<span style=color:#66d9ef>null</span>, <span style=color:#e6db74>&#39;three&#39;</span>);
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>arg1</span>, <span style=color:#a6e22e>callback</span>){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>callback</span>(<span style=color:#66d9ef>null</span>, <span style=color:#e6db74>&#39;done&#39;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>], <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>result</span>) {
</span></span><span style=display:flex><span> <span style=color:#75715e>// done
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>});
</span></span></code></pre></div><p>forEach:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>async</span>.<span style=color:#a6e22e>forEach</span>(<span style=color:#a6e22e>files</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>saveFile</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>complete</span>);
</span></span></code></pre></div><h2 id=supervisor-pegging-cpu>Supervisor Pegging CPU <a href=#supervisor-pegging-cpu class=anchor>üîó</a></h2><p>Supervisor monitors files for changes; if you have many files, your CPU starts to become pegged.</p><p>Solution: Ignore the node modules directory and any other directories not containing source code:</p><pre tabindex=0><code>supervisor -i data,node_modules app.js
</code></pre><h2 id=supervisor-doesnt-reload-configs>Supervisor doesn&rsquo;t reload configs <a href=#supervisor-doesnt-reload-configs class=anchor>üîó</a></h2><p>Solution: um, be aware of this fact, and just ctrl-c and start supervisor again when you change a config. :-)</p><h2 id=object-is-not-a-function>Object is not a function <a href=#object-is-not-a-function class=anchor>üîó</a></h2><p>This error is the bane of my existence. It happens in lots of places, for many different reasons, but here are a few that I always try to check first:</p><ul><li>module.exports is not set</li><li>when using cs, forgetting a comma, e.g. <code>fn bar 2</code> instead of <code>fn bar, 2</code></li><li>setting a property on your object with the same name as a method</li></ul><h2 id=backbone---visibility-into-views>Backbone - visibility into view(s) <a href=#backbone---visibility-into-views class=anchor>üîó</a></h2><p>If you&rsquo;re building a Backbone.js app, do yourself a favor, and set the main app view as <code>window.app_view</code> or something similar. Set other views as subviews on the main view.</p><p>This will allow you to inspect the app from FireBug after everything is up and running.</p><h2 id=sometimes-consolelog-lies---object-changes-after-being-logged>Sometimes console.log() lies - object changes after being logged <a href=#sometimes-consolelog-lies---object-changes-after-being-logged class=anchor>üîó</a></h2><p>In FireBug, doing a <code>console.log</code> on an object can be misleading if the object changes soon after it is logged. FireBug will update the nested properties of the object.</p><p>Solution: to be sure, you should <code>console.log(obj.foo.bar)</code> to see the actual value of the property at the time it is logged.</p></div><div class=tags><a href=https://mpov.timmorgan.org/tags/javascript>javascript</a>
<a href=https://mpov.timmorgan.org/tags/coffeescript>coffeescript</a>
<a href=https://mpov.timmorgan.org/tags/programming>programming</a></div></section></main><footer id=footer><div class=copyright>¬© Copyright
2022
<span class=split><svg fill="#bbb" width="15" height="15" id="heart-15" xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 15 15"><path d="M13.91 6.75c-1.17 2.25-4.3 5.31-6.07 6.94-.1903.1718-.4797.1718-.67.0C5.39 12.06 2.26 9 1.09 6.75-1.48 1.8 5-1.5 7.5 3.45 10-1.5 16.48 1.8 13.91 6.75z"/></svg></span></div><div class=powerby>Powered by <a href=http://www.gohugo.io/>Hugo</a> Theme By <a href=https://github.com/nodejh/hugo-theme-mini>nodejh</a></div></footer></body></html>